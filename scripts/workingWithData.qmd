---
title: "workingWithData"
format: html
---

```{r}
library(tidyverse)
library(descr)
library(knitr)
library(dplyr)
library(Hmisc)
library(psych)
```

```{r}
# Define file path
file_path <- file.path("..", "data", "data.rda")
# Load the .rda file in a dataframe (.rda)
df<-load(file_path)
# View the first few rows
df <- da04256.0001
remove(da04256.0001)
head(df)

```

```{r}
colnames(df)
```

```{r}
summary(df)
```

```{r}
glimpse(df)
```

```{r}
#| label: Focus Table
# FOCUS frequency table
# The Focus frequency table was added because I needed the percentage of the study that dealt with "substance abuse treatment services" and "mix of mental health and suibstaance abuse".
# With this I can know this is the right study to work with.
freq(as.ordered(df$FOCUS), plot = FALSE)
```

```{r}
#| label: Mental Health Table
# Assessment Mental Health frequency table
# The assessment mental health table was added because I needed the percantge of people that were assessed to have mental health. 
# Since the focus of this project is the mix of mental health with substance abuse, this was mandatory.
freq(as.ordered(df$SRVC2), plot = FALSE)
```

```{r}
#| label:  Therapy Table
# Therapy Individual frequency table
# The Therapy table was to see the perecentage of people that actually got therapy in the study.
freq(as.ordered(df$SRVC6), plot = FALSE)
```

```{r}
describe(df)
```

```{r}
#| label: 04 Data Management Code
#Version 1
# This block filters if the focus(FOCUS) is 'Mix of mental health and substance abuse', if there was an assement for mental health(SRCV2), and if there was therapy given(SRCV6).
# Step 1: Filter rows
DF <- tibble::as_tibble(df) %>%
  filter(FOCUS == 3 & SRVC2 == 1 & SRVC6 == 1)

myfix <- function(x) {
  ifelse(x == 1, 1,
         ifelse(x == 3, 3, NA))
}

# Applies myfix to each colum in DF
DF2 <- as.data.frame(apply(DF, 2, myfix))

#Sums across each row
DF2$MHA <- apply(DF2, 1, sum, na.rm = TRUE)


my_df <- tibble::as_tibble(df) %>% 
  filter(FOCUS == 3 & SRVC2 == 1 & SRVC6 == 1) %>% 
  select(FOCUS, SRVC2, SRVC6)
#table(df$FOCUS, df$SRVC2, df$SRVC6)


my_df <- data.frame(my_df, MHA = DF2$MHA)
my_df <- tibble::as_tibble(my_df)


dim(my_df)
```

```{r}
#| label: 04 Data Management Code
#Version 2
#MHA is mental health assessment
# Step 1: Filter the data
DF <- tibble::as_tibble(df) %>%
  filter(FOCUS == 1 & SRVC2 == 1 & SRVC6 == 1)

# Step 2: Apply myfix only to selected columns (excluding FOCUS, SRVC2, SRVC6)
DF2 <- DF %>%
  select(-FOCUS, -SRVC2, -SRVC6) %>%
  mutate(across(everything(), ~ ifelse(.x == 1, 1, NA)))

# Step 3: Calculate MHA score
DF2$MHA <- apply(DF2, 1, sum, na.rm = TRUE)

# Step 4: Combine with original filtered columns
my_df <- DF %>% select(FOCUS, SRVC2, SRVC6)
my_df$MHA <- DF2$MHA

# Step 5: Check dimensions
dim(my_df)
```

```{r}
#| label: 04 Data Management Code
#Version 3
# Step 1: Filter the data
DF <- tibble::as_tibble(df) %>%
  filter(FOCUS == 3 & SRVC2 == 1 & SRVC6 == 1)

# Step 2: Apply myfix only to selected columns (excluding FOCUS, SRVC2, SRVC6)
DF2 <- DF %>%
  select(-FOCUS, -SRVC2, -SRVC6) %>%
  mutate(across(everything(), ~ ifelse(.x == 1, 1, ifelse(.x == 3, 3, NA))))

# Step 3: Calculate MHA score
DF2$MHA <- apply(DF2, 1, sum, na.rm = TRUE)

# Step 4: Combine with original filtered columns
my_df <- DF %>% select(FOCUS, SRVC2, SRVC6)
#table(df$FOCUS, df$SRVC2, df$SRVC6)
my_df$MHA <- DF2$MHA

# Step 5: Check dimensions
dim(my_df)
```

```{r}
#| label: Filtering Practice
filtered <- df %>%
  select(FOCUS, SRVC2, SRVC6)

#print(filtered)
```

```{r}
#| label: Removing Dataset Chunk
# For removing test data sets
rm()
```
